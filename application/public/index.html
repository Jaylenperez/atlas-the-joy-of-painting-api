<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bob Ross Episode Search</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    .episode { border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem; }
    .filter-group { margin-top: 1rem; }
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
      margin-top: 0.5rem;
    }
    .filter-options label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
  </style>
</head>
<h1>Search Bob Ross Episodes</h1>
<body>

  <!-- Search Bar -->
  <label>
    Search by Title:
    <input type="text" id="titleInput" placeholder="e.g. A Walk in the Woods" />
  </label>

  <!-- Filter by Subject -->
  <div class="filter-group">
    <strong>Filter by Subject:</strong>
    <div id="subjectFilters" class="filter-options"></div>
  </div>

  <!-- Filter by Color -->
  <div class="filter-group">
    <strong>Filter by Color:</strong>
    <div id="colorFilters" class="filter-options"></div>
  </div>

  <!-- Search Button -->
  <button onclick="filterEpisodes()">Search</button>

  <div id="results" style="margin-top: 2rem;"></div>

  <div id="pagination" style="margin-top: 1rem;"></div>

  <script>
  let episodes = [];
  let filteredResults = [];
  let currentPage = 1;
  const resultsPerPage = 6;

  async function loadData() {
    const res = await fetch('data.json');
    episodes = await res.json();
    populateFilters();
  }

  function populateFilters() {
    const subjectSet = new Set();
    const colorSet = new Set();

    episodes.forEach(ep => {
      ep.subject.split(',').forEach(s => {
        const trimmed = s.trim();
        if (trimmed) subjectSet.add(trimmed);
      });
      ep.colors.split(',').forEach(c => {
        const trimmed = c.trim();
        if (trimmed) colorSet.add(trimmed);
      });
    });

    const subjectFilters = document.getElementById('subjectFilters');
    const colorFilters = document.getElementById('colorFilters');

    [...subjectSet].sort().forEach(subject => {
      const label = document.createElement('label');
      label.innerHTML = `
        <input type="checkbox" name="subject" value="${subject}" />
        ${subject}
      `;
      subjectFilters.appendChild(label);
    });

    [...colorSet].sort().forEach(color => {
      const label = document.createElement('label');
      label.innerHTML = `
        <input type="checkbox" name="color" value="${color}" />
        ${color}
      `;
      colorFilters.appendChild(label);
    });
  }

  function filterEpisodes() {
    const titleQuery = document.getElementById('titleInput').value.toLowerCase();
    const selectedSubjects = Array.from(document.querySelectorAll('input[name="subject"]:checked')).map(cb => cb.value);
    const selectedColors = Array.from(document.querySelectorAll('input[name="color"]:checked')).map(cb => cb.value);

    filteredResults = episodes.filter(ep => {
      const matchTitle = !titleQuery || ep.title.toLowerCase().includes(titleQuery);

      const subjectList = ep.subject.split(',').map(s => s.trim());
      const colorList = ep.colors.split(',').map(c => c.trim());

      const matchSubject = selectedSubjects.every(s => subjectList.includes(s));
      const matchColor = selectedColors.every(c => colorList.includes(c));

      return matchTitle && matchSubject && matchColor;
  });

  currentPage = 1; // reset to first page
  displayResults();
  displayPagination();
}


  function displayResults() {
    const container = document.getElementById('results');
    container.innerHTML = '';

    if (filteredResults.length === 0) {
      container.textContent = 'No matching episodes found.';
      document.getElementById('pagination').innerHTML = '';
      return;
    }

    const start = (currentPage - 1) * resultsPerPage;
    const end = start + resultsPerPage;
    const currentPageResults = filteredResults.slice(start, end);

    currentPageResults.forEach(ep => {
      const div = document.createElement('div');
      div.className = 'episode';
      div.innerHTML = `
        <h2>${ep.title} (Season ${ep.season}, Episode ${ep.episode})</h2>
        <p><strong>Air Date:</strong> ${ep.air_date}</p>
        <p><strong>Subjects:</strong> ${ep.subject}</p>
        <p><strong>Colors:</strong> ${ep.colors}</p>
        <img src="${ep.img_src}" width="300" loading="lazy" />
        <p><a href="${ep.youtube_src}" target="_blank">Watch Episode</a></p>
      `;
      container.appendChild(div);
    });
  }

  function displayPagination() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'Previous';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      currentPage--;
      displayResults();
      displayPagination();
    };

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      currentPage++;
      displayResults();
      displayPagination();
    };

    pagination.appendChild(prevBtn);
    pagination.appendChild(document.createTextNode(` Page ${currentPage} of ${totalPages} `));
    pagination.appendChild(nextBtn);
  }

  loadData();
</script>

</body>
</html>
