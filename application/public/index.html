<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Page Title</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
<h1>The Joy Of Painting Episode Search</h1>
<p>This is a paragraph.</p>
</header>
<main>
    <section id="filters">
        <form id="filterForm">
          <!-- Year Filter -->
          <div class="filter-group">
            <label for="yearFilter">Year:</label>
            <select id="yearFilter" name="year">
              <option value="">Select Year</option>
            </select>
          </div>
          <!-- Month Filter -->
          <div class="filter-group">
            <label for="monthFilter">Month:</label>
            <select id="monthFilter" name="month">
              <option value="">Select Month</option>
            </select>
          </div>
          <!-- Season Filter -->
          <div class="filter-group">
            <label for="seasonFilter">Season:</label>
            <select id="seasonFilter" name="season">
              <option value="">Select Season</option>
            </select>
          </div>
          <div>
            <h4>Subjects</h4>
              <div id="subjectsContainer">
          </div>
            <div>
                <h4>Colors</h4>
                <div id="colorsContainer"></div>
            </div>
            <div>
                <button>Search</button>
            </div>
      </section>
</main>

<script>
  // Wait for the DOM content to load
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Make a GET request to your endpoint
      const response = await fetch('/api/episodes/years');
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      // Parse the response as JSON
      const result = await response.json();
      const years = result.data; // Expecting data as an array of objects, e.g., [{ "year": 1983 }, { "year": 1984 }, ...]
      const yearFilter = document.getElementById("yearFilter");

      // Loop through the years and create option elements
      years.forEach(item => {
        const option = document.createElement("option");
        option.value = item.year;
        option.textContent = item.year;
        yearFilter.appendChild(option);
      });
    } catch (error) {
      console.error("Error fetching years:", error);
    }

    // Fetch and populate months
    try {
      const responseMonths = await fetch('/api/episodes/months');
      if (!responseMonths.ok) {
        throw new Error('Network response was not ok for months endpoint');
      }
      const resultMonths = await responseMonths.json();
      const months = resultMonths.data;
      const monthFilter = document.getElementById('monthFilter');

      // Create option elements for each month from the endpoint
      months.forEach(item => {
        const option = document.createElement("option");
        option.value = item.month;
        option.textContent = item.month;
        monthFilter.appendChild(option);
      });
    } catch (error) {
      console.error("Error fetching months:", error);
    }

    // fetch and populate seasons 
    try {
    const response = await fetch('/api/colors/seasons');
    if (!response.ok) {
      throw new Error('Network response was not ok for seasons endpoint');
    }
    const result = await response.json();
    const seasons = result.data;
    const seasonFilter = document.getElementById("seasonFilter");
    
    seasons.forEach(item => {
      const option = document.createElement("option");
      option.value = item.season;
      option.textContent = item.season;
      seasonFilter.appendChild(option);
    });
  } catch (error) {
    console.error("Error fetching seasons:", error);
  }

  // fetch subjects
  try {
      // Fetch subjects from the endpoint
      const response = await fetch('/api/subjects/subject');
      if (!response.ok) {
        throw new Error('Network response was not ok for subjects endpoint');
      }
      const result = await response.json();
      const subjects = result.data; // Expecting an array of subjects (unique subject strings)
      
      // Get the container where the checkboxes should be added
      const subjectsContainer = document.getElementById("subjectsContainer");
      
      // Clear any existing content (optional)
      subjectsContainer.innerHTML = "";
      
      // Iterate over the subjects array and create a checkbox for each subject
      subjects.forEach(subject => {
        // Create a container div for the individual checkbox option
        const optionDiv = document.createElement("div");
        optionDiv.classList.add("checkbox-option");
        
        // Create the checkbox input
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        // Using the subject string as the id may cause issues if it has spaces or special characters.
        // You can replace spaces with underscores or create a unique id in another way:
        checkbox.id = 'sub_' + subject.replace(/\s+/g, '_');
        checkbox.name = "filterOptions";
        checkbox.value = subject;
        
        // Create the label
        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.textContent = subject;
        
        // Append the checkbox and label to the div
        optionDiv.appendChild(checkbox);
        optionDiv.appendChild(label);
        
        // Append the new div to the container
        subjectsContainer.appendChild(optionDiv);
      });
    } catch (error) {
      console.error("Error fetching subjects:", error);
    }

    // fetch colors data
    try {
      const responseColors = await fetch('/api/colors/colors');
      if (!responseColors.ok) {
        throw new Error('Network response was not ok for colors endpoint');
      }
      const resultColors = await responseColors.json();
      const colors = resultColors.data; // Expects an array of color strings, e.g., ["Alizarin Crimson", "Bright Red", ...]
      
      // Get the container for the color checkboxes
      const colorsContainer = document.getElementById("colorsContainer");
      
      // Clear existing content, if any
      colorsContainer.innerHTML = "";
      
      // For each color, create a checkbox with a label
      colors.forEach(color => {
        // Create a div for the individual checkbox
        const optionDiv = document.createElement("div");
        optionDiv.classList.add("checkbox-option");
        
        // Create the checkbox input
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        // Create a unique id by replacing spaces in the color name with underscores
        checkbox.id = 'color_' + color.replace(/\s+/g, '_');
        checkbox.name = "filterColors"; // Use a relevant name for colors
        checkbox.value = color;
        
        // Create the label for the checkbox
        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.textContent = color;
        
        // Append the checkbox and label to the container div
        optionDiv.appendChild(checkbox);
        optionDiv.appendChild(label);
        
        // Append the div to the colors container
        colorsContainer.appendChild(optionDiv);
      });
    } catch (error) {
      console.error("Error fetching colors:", error);
    }
  });
</script>
</body>
</html>