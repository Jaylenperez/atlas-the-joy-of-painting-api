<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bob Ross Episode Search</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    .episode { border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem; }
    .filter-group { margin-top: 1rem; }
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
      margin-top: 0.5rem;
    }
    .filter-options label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
  </style>
</head>
<body>
  <h1>Search Bob Ross Episodes</h1>

  <!-- Search Bar -->
  <label>
    Search by Title:
    <input type="text" id="titleInput" placeholder="e.g. A Walk in the Woods" />
  </label>

  <!-- Filter by Subject -->
  <div class="filter-group">
    <strong>Filter by Subject:</strong>
    <div id="subjectFilters" class="filter-options"></div>
  </div>

  <!-- Filter by Color -->
  <div class="filter-group">
    <strong>Filter by Color:</strong>
    <div id="colorFilters" class="filter-options"></div>
  </div>

  <!-- Search Button -->
  <button onclick="filterEpisodes()">Search</button>

  <div id="results" style="margin-top: 2rem;"></div>

  <script>
    let episodes = [];

    async function loadData() {
      const res = await fetch('data.json');
      episodes = await res.json();
      populateFilters();
    }

    function populateFilters() {
      const subjectSet = new Set();
      const colorSet = new Set();

      episodes.forEach(ep => {
        ep.subject.split(',').forEach(s => {
          const trimmed = s.trim();
          if (trimmed) subjectSet.add(trimmed);
        });
        ep.colors.split(',').forEach(c => colorSet.add(c.trim()));
      });

      const subjectFilters = document.getElementById('subjectFilters');
      const colorFilters = document.getElementById('colorFilters');

      [...subjectSet].sort().forEach(subject => {
        const label = document.createElement('label');
        label.innerHTML = `
          <input type="checkbox" name="subject" value="${subject}" />
          ${subject}
        `;
        subjectFilters.appendChild(label);
      });

      [...colorSet].sort().forEach(color => {
        const label = document.createElement('label');
        label.innerHTML = `
          <input type="checkbox" name="color" value="${color}" />
          ${color}
        `;
        colorFilters.appendChild(label);
      });
    }

    function filterEpisodes() {
      const titleQuery = document.getElementById('titleInput').value.toLowerCase();

      const selectedSubjects = Array.from(document.querySelectorAll('input[name="subject"]:checked')).map(cb => cb.value);
      const selectedColors = Array.from(document.querySelectorAll('input[name="color"]:checked')).map(cb => cb.value);

      const results = episodes.filter(ep => {
        const matchTitle = !titleQuery || ep.title.toLowerCase().includes(titleQuery);
        const matchSubject = selectedSubjects.length === 0 || selectedSubjects.some(s => ep.subject.includes(s));
        const matchColor = selectedColors.length === 0 || selectedColors.some(c => ep.colors.includes(c));
        return matchTitle && matchSubject && matchColor;
      });

      displayResults(results);
    }

    function displayResults(episodes) {
      const container = document.getElementById('results');
      container.innerHTML = '';

      if (episodes.length === 0) {
        container.textContent = 'No matching episodes found.';
        return;
      }

      episodes.forEach(ep => {
        const div = document.createElement('div');
        div.className = 'episode';
        div.innerHTML = `
          <h2>${ep.title} (Season ${ep.season}, Episode ${ep.episode})</h2>
          <p><strong>Air Date:</strong> ${ep.air_date}</p>
          <p><strong>Subjects:</strong> ${ep.subject}</p>
          <p><strong>Colors:</strong> ${ep.colors}</p>
          <img src="${ep.img_src}" width="300" />
          <p><a href="${ep.youtube_src}" target="_blank">Watch Episode</a></p>
        `;
        container.appendChild(div);
      });
    }

    loadData();
  </script>
</body>
</html>
